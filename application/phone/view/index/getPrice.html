<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>大叔报价</title>
<link rel="stylesheet" type="text/css" href="__CSS__/bootstrap.min.css">
<link rel="stylesheet" type="text/css"
	href="__CSS__/font-awesome.min.css">
<!-- <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
<link rel="stylesheet" type="text/css" href="__CSS__/comms/enquiry.css">
</head>
<body>


	<div class="panel panel-default" style="margin: 0 0;">
		<div class="panel-heading">
			<h3 style="color: #3c763d;">{$B['comm']['comm_name']}<small style="padding-left:3%">{$B['comm']['region']}-{$B['comm']['block']}</small></h3>
		</div>
		<div class="panel-body" style="padding-top: 0;font-size: 18px;">
			<ul class="nav nav-pills nav-tabs" >
				<li class="active" ><a href="#base" aria-controls="base" role="tab" data-toggle="tab" >基价</a></li>
				<li ><a href="#box" aria-controls="box" role="tab" data-toggle="tab" >盒须图</a></li>
				<li ><a href="#box1" aria-controls="box1" role="tab" data-toggle="tab" >参数</a></li>
				<!-- <li ><a href="#box2" aria-controls="box2" role="tab" data-toggle="tab" >下拉菜单</a></li> -->
				<li role="presentation" class="dropdown">
				    <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
				      {$Think.session.user.user_name} <span class="caret"></span>
				    </a>
				    <ul class="dropdown-menu">
					    <li ><a href="#scatter_area_price" aria-controls="scatter_area_price" role="tab" data-toggle="tab" >面积/房价散点</a></li>
					    <li ><a href="#scatter_floor_price" aria-controls="scatter_floor_price" role="tab" data-toggle="tab" >总楼层/房价散点</a></li>
					    <li ><a href="#box2" aria-controls="box2" role="tab" data-toggle="tab" >导出Excel</a></li>
					    <li ><a href="{:url('evalu/login/logout')}" >注销</a></li>
					</ul>
			    <!-- </ul> -->
			  	</li>
			</ul>
			
			  <div class="tab-content">
			  	<!-- 基本报价 -->
			    <div role="tabpanel" class="tab-pane active" id="base">
	   				<div class="panel panel-success">
						<div class="panel-heading">
							<span class="badge" style="font-size: 16px">
							{if condition="$B['priceByDeal'] > 0 "}
							二手房评估
							{else /} 抵押评估价
							{/if}
							</span>
							<h1 style="text-align: center; font-weight: 700;{if condition="$B['std_r'] > 12 "}opacity:0.5;{/if}">
							{if condition="$B['priceByDeal'] > 0 "}
							{$B['priceByDeal']}
							{else /} {$B['mortgagePrice']}
							{/if}
								元 <small>/平方米</small>
							</h1>
							{if condition="$B['std_r'] > 12 "}
							<p  style="text-align:center;color:#DD5A43;">数据离散性过大，本报价需要估价师确认</p>
							{/if}
		
						</div>
						<div class="list-group"	>
							<li class="list-group-item" >基价内涵</li>
							<table class="table">
								<tr>
									<td class="col-md-4 col-xs-4 left" >面积</td>
									<td class="col-md-8 col-xs-8 right">{$B['avg_area']}平方米</td>
			
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left" >层次</td>
									<td class="col-md-8 col-xs-8 right">{$B['avg_floor_index']}层/共{$B['avg_total_floor']}层</td>
			
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left " >建成年份</td>
									<td class="col-md-8 col-xs-8 right">{$B['avg_builded_year']}年</td>
								</tr>
								</table>
						</div>
					</div>
				</div>
				<!-- 盒须图 -->
			    <div role="tabpanel" class="tab-pane" id="box">
				    <div class="panel panel-success">
						<div class="panel-heading" style="width:100% ;height:400px" >
							<svg xmlns="http://www.w3.org/2000/svg" version="1.1" >
								<!-- 竖向盒须图，基本只和Y轴有关，X轴相对固定 -->
								<!-- 前端的异常值 -->
								<line x1="{$B['X']+1}%" y1="{$B['Qmin']}%" x2="{$B['X']+$B['box_width']-1}%" y2="{$B['Qmin']}%"  style="stroke-dasharray: 5;"/>
								<line x1="{$B['X']+$B['box_width']/2}%" y1="{$B['Qmin']}%" x2="{$B['X']+$B['box_width']/2}%" y2="{$B['Q1']}%"  style="stroke-dasharray: 5;"/>
								<!-- 后端的异常值 -->	
								<line x1="{$B['X']+1}%" y1="{$B['Qmax']}%" x2="{$B['X']+$B['box_width']-1}%" y2="{$B['Qmax']}%"  style=" stroke-dasharray: 5;"/>
								<line x1="{$B['X']+$B['box_width']/2}%" y1="{$B['Qmax']}%" x2="{$B['X']+$B['box_width']/2}%" y2="{$B['Q3']}%"  style=" stroke-dasharray: 5;"/>
													
								<!-- 盒子 -->
								<rect class='plotbox_box' x="{$B['X']}%" y="{$B['Q1']}%" width="{$B['box_width']}%" height="{$B['Q3']-$B['Q1']}%"  />
								<!-- 前须 -->
								<line x1="{$B['X']}%" y1="{$B['Q0']}%" x2="{$B['X']+$B['box_width']}%" y2="{$B['Q0']}%"  />
								<line x1="{$B['X']+$B['box_width']/2}%" y1="{$B['Q0']}%" x2="{$B['X']+$B['box_width']/2}%" y2="{$B['Q1']}%"  />
								<!-- 后须 -->
								<line x1="{$B['X']}%" y1="{$B['Q4']}%" x2="{$B['X']+$B['box_width']}%" y2="{$B['Q4']}%"  />
								<line x1="{$B['X']+$B['box_width']/2}%" y1="{$B['Q4']}%" x2="{$B['X']+$B['box_width']/2}%" y2="{$B['Q3']}%"  />
								<!-- 中位数 -->
								<line x1="{$B['X']}%" y1="{$B['Q2']}%" x2="{$B['X']+$B['box_width']}%" y2="{$B['Q2']}%"  style="stroke:#DFF0D8; "/>
								<!-- 显示数字 -->
								<text class='plotboxtext' x="{$B['X']+$B['box_width']+2}%" y="{$B['Qmin']}%" >{$B['min']}</text>
								<text x="{$B['X']+$B['box_width']+2}%" y="{$B['Q0']}%" class='plotboxtext'>{$B['Q0v']}</text>
								<text x="{$B['X']+$B['box_width']+2}%" y="{$B['Q1']}%" class='plotboxtext'>{$B['v25']}</text>
								<text x="{$B['X']+$B['box_width']+2}%" y="{$B['Q2']}%" class='plotboxtext'>{$B['median']}</text>
								<text x="{$B['X']+$B['box_width']+2}%" y="{$B['Q3']}%" class='plotboxtext'>{$B['v75']}</text>
								<text x="{$B['X']+$B['box_width']+2}%" y="{$B['Q4']}%" class='plotboxtext' >{$B['Q4v']}</text>
								<text x="{$B['X']+$B['box_width']+2}%" y="{$B['Qmax']}%" class='plotboxtext' >{$B['max']}</text>
					            <!-- 画直方图 -->
								{volist name="B['barChart']" id="vo"  }
								<!-- 	{$key}.{$vo} -->
									<rect x="{$B['X']-$vo*$B['x_unit']-10}%" y="{$key*$B['y_unit']+$B['Y_padding']}%" width="{$vo*$B['x_unit']}%" height="{$B['y_unit']-1}%" class='barChart' />
									<text x="{$B['X']-$vo*$B['x_unit']/2-10}%" y="{$key*$B['y_unit']+$B['Y_padding']+$B['y_unit']-2}%" class='barChart_text'>{$vo}</text>
								{/volist}
							</svg>
							
						</div>
					</div>
			    </div>
			    <!-- 参数 -->
			    <div role="tabpanel" class="tab-pane" id="box1">
			    	<div class="list-group"	>
							<li class="list-group-item" >数据参数</li>
							<table class="table">
								<tr>
									<td class="col-md-4 col-xs-4 left " >数据开始</td>
									<td class="col-md-8 col-xs-8 right">{$B['from_date']}</td>
			
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left" >数据量</td>
									<td class="col-md-8 col-xs-8 right">{$B['len']}/{$B['ori_len']}，覆盖{$B['coverage']}%</td>
			
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left" >标准差系数</td>
									<td class="col-md-8 col-xs-8 right">{$B['std_r']}%</td>
			
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left" >均价</td>
									<td class="col-md-8 col-xs-8 right">{$B['mean']}元/平方米</td>
			
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left" >抵押折扣率</td>
									<td class="col-md-8 col-xs-8 right">{$B['mortgageRatio']*100}%</td>
			
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left " >二手价</td>
									<td class="col-md-8 col-xs-8 right">{$B['dealPricePosition']}%/{$B['dealPrice']}</td>
								</tr>
								<tr>
									<td class="col-md-4 col-xs-4 left " >交易价/二手报价</td>
									<td class="col-md-8 col-xs-8 right">{$B['price']}/{$B['priceByDeal']}</td>
								</tr>
								</table>
						</div>
<!-- 					{volist name="B" id="vo"  }
					{$key}
					{/volist} -->
					<!-- {php}var_dump($B){/php} -->
			    </div>
			    
			    <!-- 面积楼价散点图 -->
			    <div role="tabpanel" class="tab-pane" id="scatter_area_price">
   				    <div class="panel panel-success">
						<div class="panel-heading" style="width:100% ;height:400px" >
							<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%">
								{volist name="B['area_price_scatter']['A_line']" id="vo"  }
									<line x1="{$vo['x0']}%" y1="{$vo['y0']}%" x2="{$vo['x1']}%" y2="{$vo['y1']}%"  class='scatter_line' />
									<text x="{$vo['t_x']}%" y="{$vo['t_y']}%" 
									class='{if condition="$vo['t_x'] == 0 ")}
									scatter_text_y
									{else /} scatter_text_x
									{/if} scatter_text' >{$vo['val']}</text>
								{/volist}
								{volist name="B['area_price_scatter']['A']" id="vo"  }
									<circle cx="{$vo['x']}%" cy="{$vo['y']}%" class = 'scatter_circle' r="1%"/>
								{/volist}
									<line x1="{$B['area_price_scatter']['axes'][0]['x0']}%" y1="{$B['area_price_scatter']['axes'][0]['y0']}%" x2="{$B['area_price_scatter']['axes'][0]['x1']}%" y2="{$B['area_price_scatter']['axes'][0]['y1']}%"  class='scatter_axes' />
									<text x="{$B['area_price_scatter']['axes'][0]['t_x']}%" y="{$B['area_price_scatter']['axes'][0]['t_y']}%"  class='XAxesText'>{$B['area_price_scatter']['axes'][0]['val']}</text>
									<line x1="{$B['area_price_scatter']['axes'][1]['x0']}%" y1="{$B['area_price_scatter']['axes'][1]['y0']}%" x2="{$B['area_price_scatter']['axes'][1]['x1']}%" y2="{$B['area_price_scatter']['axes'][1]['y1']}%"  class='scatter_axes' />
									<text x="{$B['area_price_scatter']['axes'][1]['t_x']}%" y="{$B['area_price_scatter']['axes'][1]['t_y']}%" class='YAxesText'>{$B['area_price_scatter']['axes'][1]['val']}</text>
							</svg>
						</div>
					</div>
				</div>
				
				<!-- 楼层楼价散点图 -->
			    <div role="tabpanel" class="tab-pane" id="scatter_floor_price">
			    	<div class="panel panel-success">
						<div class="panel-heading" style="width:100% ;height:400px" >
							<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%">
								{volist name="B['floor_price_scatter']['A_line']" id="vo"  }
									<line x1="{$vo['x0']}%" y1="{$vo['y0']}%" x2="{$vo['x1']}%" y2="{$vo['y1']}%"  class='scatter_line' />
									<text x="{$vo['t_x']}%" y="{$vo['t_y']}%" 
									class='{if condition="$vo['t_x'] == 0 ")}
									scatter_text_y
									{else /} scatter_text_x
									{/if} scatter_text' >{$vo['val']}</text>
								{/volist}
								{volist name="B['floor_price_scatter']['A']" id="vo"  }
									<circle cx="{$vo['x']}%" cy="{$vo['y']}%" class = 'scatter_circle' r="1%"/>
								{/volist}
									<line x1="{$B['floor_price_scatter']['axes'][0]['x0']}%" y1="{$B['floor_price_scatter']['axes'][0]['y0']}%" x2="{$B['floor_price_scatter']['axes'][0]['x1']}%" y2="{$B['floor_price_scatter']['axes'][0]['y1']}%"  class='scatter_axes' />
									<text x="{$B['floor_price_scatter']['axes'][0]['t_x']}%" y="{$B['floor_price_scatter']['axes'][0]['t_y']}%"  class='XAxesText'>{$B['floor_price_scatter']['axes'][0]['val']}</text>
									<line x1="{$B['floor_price_scatter']['axes'][1]['x0']}%" y1="{$B['floor_price_scatter']['axes'][1]['y0']}%" x2="{$B['floor_price_scatter']['axes'][1]['x1']}%" y2="{$B['floor_price_scatter']['axes'][1]['y1']}%"  class='scatter_axes' />
									<text x="{$B['floor_price_scatter']['axes'][1]['t_x']}%" y="{$B['floor_price_scatter']['axes'][1]['t_y']}%" class='YAxesText'>{$B['floor_price_scatter']['axes'][1]['val']}</text>
							</svg>
						</div>
			    	</div>

				</div>
			    <div role="tabpanel" class="tab-pane" id="box2">44</div>
			  </div>


			
			
			<a class="btn btn-success btn-block btn-lg" href="{:url('index')}">返回</a>

			 <div class="input-group input-group-lg" style="margin-top:10px;">
		      <input type="text" class="form-control" placeholder="输入您认为合适的评估价..." id="myprice">
		      <span class="input-group-btn ">
		        <button class="btn btn-success " id="dispute" type="button">&emsp;我有异议 !&emsp;</button>
		      </span>
		    </div>
		</div>
	</div>
	
	<!-- 模态框 -->
	<div class="modal" tabindex="-1" role="dialog" id="mymodal">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="mymodal_header">Modal title</h4>
	      </div>
	      <div class="modal-body" id='mymodal-body'>
	        <p>One fine body&hellip;</p>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	      </div>
	    </div><!-- /.modal-content -->
	  </div><!-- /.modal-dialog -->
	</div><!-- /.modal -->


	<script src="__JS__/jquery-2.1.4.min.js"></script>
	<script src="__JS__/bootstrap.min.js"></script> 
<!-- 	<script src="__JS__/comms/phoneGetPrice.js"></script>  -->
	<script type="text/JavaScript">
	jQuery(function($) {
		
		jQuery("#dispute").on('click',function (){
			$.ajax({
				url:'{:url('dispute')}',
				type:'POST',
				data:{
					comm_id:{$B['comm']['comm_id']},
					myprice:$('#myprice').val(),
					my_min:{$B['min']},
					my_max:{$B['max']},
        		},
         		/* beforeSend:function(){
        			if(($('#myprice').val()<{$B['min']*0.8}) || ($('#myprice').val()>{$B['max']})){
        				$('#mymodal_header').html('抱歉');
        				$('#mymodal-body').html('感谢您的参与，但您提供的评估价未被采纳');
        				$('#mymodal').modal('show');
        				$('#myprice').val('');
        				return false;
        			}
        		} , */
        		success: function(msg){
        			$('#mymodal_header').html(msg['h']);
    				$('#mymodal-body').html('<p>'+ msg['b'] + '</p>');
    				$('#mymodal').modal('show');
    				$('#myprice').val('');
       		   }
				
			});
		} );
		     
	})
	</script>
	

</body>
</html>