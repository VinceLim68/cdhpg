<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>登录 - 大叔评估</title>

		<meta name="description" content="User login page" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="__CSS__/bootstrap.min.css" />
		<link rel="stylesheet" href="__CSS__/font-awesome.min.css" />

		<!-- text fonts -->
		<link rel="stylesheet" href="__CSS__/fonts.googleapis.com.css" />

		<!-- ace styles -->
		<link rel="stylesheet" href="__CSS__/ace.min.css" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="__CSS__/ace-part2.min.css" />
		<![endif]-->
		<link rel="stylesheet" href="__CSS__/ace-rtl.min.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="__CSS__/ace-ie.min.css" />
		<![endif]-->

		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

		<!--[if lte IE 8]>
		<script src="__JS__/html5shiv.min.js"></script>
		<script src="__JS__/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="login-layout">
		<div class="main-container">
			<div class="main-content">
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<div class="login-container">
							<div class="center">
								<h1>
									
									<i class="ace-icon fa fa-coffee green"></i>
									<span class="red">大叔评估</span>
									<small><span class="white" id="id-text2">厦门诚德行</span></small>
								</h1>
								<h4 class="blue" id="id-company-text">&copy; 林晓13600966656</h4>
							</div>

							<div class="space-6"></div>

							<div class="position-relative">
								<div id="login-box" class="login-box visible widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header blue lighter bigger">
												<i class="ace-icon fa fa-leaf green"></i>
												请输入您的帐号信息
											</h4>

											<div class="space-6"></div>

											<form method="post" >
												<fieldset>
													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" placeholder="用户名" name='user_name' id="login_user_name"/>
															<i class="ace-icon fa fa-user"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" placeholder="密码" name='pass' id="login_pass"/>
															<i class="ace-icon fa fa-lock"></i>
														</span>
													</label>

                                                    <!-- <input type="hidden" name="mod" value="{$module}">  -->
                                                    
													<div class="space"></div>
							<!-- 							<button  class="width-35 pull-right btn btn-sm btn-primary">
															<i class="ace-icon fa fa-key"></i>
															<span class="bigger-110">登录</span>
														</button> -->
							 							<a  class="width-35 pull-right btn btn-sm btn-primary" onclick="login()" >
															<i class="ace-icon fa fa-key"></i>
															<span class="bigger-110">登录</span>
														</a> 
								
													</div>

													<div class="space-4"></div>
												</fieldset>
											</form>

										</div><!-- /.widget-main -->

 										<div class="toolbar clearfix " >
											<div style = "text-align: center;width:100%;margin:0,auto;">
												<a href="#" data-target="#signup-box" class="user-signup-link">
													
													<i class="ace-icon fa fa-arrow-right"></i>
                                                   		注册<small style="padding-left:10px">测试期间，开放注册</small>                                                                                
												</a>
											</div>
										</div>
									</div><!-- /.widget-body -->
								</div><!-- /.login-box -->


								<div id="signup-box" class="signup-box widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header green lighter bigger">
												<i class="ace-icon fa fa-users blue"></i>
												新用户注册
											</h4>

											<div class="space-6"></div>

											<form id="sign_up_form">
												<fieldset>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" placeholder="用户名" name='user_name'/>
															<i class="ace-icon fa fa-user"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" placeholder="密码" name="pass"/>
															<i class="ace-icon fa fa-lock"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" placeholder="再确认一次密码" name="pass_confirm"/>
															<i class="ace-icon fa fa-retweet"></i>
														</span>
													</label>
                                                    
                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input type="text" class="form-control" placeholder="邮箱" name="email"/>
                                                            <i class="ace-icon fa fa-envelope"></i>
                                                        </span>
                                                    </label>
                                                    
                                                   <!--  <input type="hidden" name="mod" value="{$module}">  -->

													<div class="space-24"></div>

													<div class="clearfix">
														<button type="reset" class="width-30 pull-left btn btn-sm">
															<i class="ace-icon fa fa-refresh"></i>
															<span class="bigger-110">重置</span>
														</button>

			<!-- 											<button type="submit" class="width-65 pull-right btn btn-sm btn-success">
															<span class="bigger-110">注册</span>

															<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
														</button> -->
														<a  class="width-65 pull-right btn btn-sm btn-success" onclick="sign_up()" >
															<span class="bigger-110">注册</span>

															<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
														</a> 
													</div>
												</fieldset>
											</form>
										</div>

										<div class="toolbar center">
											<a href="#" data-target="#login-box" class="back-to-login-link" style="font-weight: normal;">
												<i class="ace-icon fa fa-arrow-left"></i>
												回到登录页面
											</a>
										</div>
									</div><!-- /.widget-body -->
								</div><!-- /.signup-box -->
							</div><!-- /.position-relative -->

			
						</div>
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.main-content -->
		</div><!-- /.main-container -->


		<!--[if !IE]> -->
		<script src="__JS__/jquery-2.1.4.min.js"></script>

		<!-- <![endif]-->

		<!--[if IE]>
			<script src="__JS__/jquery-1.11.3.min.js"></script>
		<![endif]-->
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='__JS__/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>

		<!-- inline scripts related to this page -->
		<script type="text/javascript">
			jQuery(function($) {
				 $(document).on('click', '.toolbar a[data-target]', function(e) {
					e.preventDefault();
					var target = $(this).data('target');
					$('.widget-box.visible').removeClass('visible');//hide others
					$(target).addClass('visible');//show target
				 });
				 
				 
			});
			
		</script>

</body>
<script type="text/javascript" src="__JS__/common/localstorage.js"></script>
<script type="text/javascript">
	var Jumpurl = "{:url('login/login',['module' => $module,'controller'=>$controller,'action'=>$action,'input'=>$input])}";
	var getUIDurl = "{:url('login/ajax_getUid')}";
	var ajax_login_verify_url = "{:url('login/ajax_login_verify')}";
	var phone_url = "{:url('phone/index/index')}";
	var evalu_url = "{:url('evalu/sales/salesList')}";
	var module = "{$module}";
	var controller = "{$controller}";
	var action = "{$action}";	
	var origin_url = '/'+module+'/'+controller+'/'+action;
	//var real_url = "{$Request.root.true}"+origin_url;
	var real_url = "{:url('',$input)}";
			//alert('0  '+real_url);
	real_url = (real_url.replace(/\/evalu\/login\/auto_jump/,origin_url));
	//var real_url = "{:url($module+'/'+$controller+'/'+$action,$input)}";
	//var real_url = "{:url($module+'/'+$controller+'/'+$action)}";

	//登录函数
	function login() {
		//先看看有没有机器码，没有就设置一个
		MachineID_handle();
		var user = $("#login_user_name").val();
		var pass = $("#login_pass").val();
//		alert(user_encode);
		//alert('logining。。。。')
		login_handle(user,pass,getMachineID,"重新登录成功");
	}
	
	//注册函数
	function sign_up(){
		MachineID_handle();
		var user_name = $("#sign_up_form input[name='user_name']").val();
		var pass = $("#sign_up_form input[name='pass']").val();
		var pass_confirm = $("#sign_up_form input[name='pass_confirm']").val();
		var email = $("#sign_up_form input[name='email']").val();
		$.ajax({
	        url: "{:url('signup')}",
	        data: {
	        	user_name : user_name,
	            pass : pass,
	            matchineID : getMachineID,
	            pass_confirm : pass_confirm,
	            email : email,
	        },
	        success: function(data) {
	            if(data.valid == 1){
	           		//因为是注册，需要重置用户名和密码,
	           		//机器码用MachineID_handle()已经建立了，不必存。
	           		storage["user"] = user_name;
	           		storage["password"] = pass;
	            	
	           		//origin_url = '/'+module+'/'+controller+'/'+action;
	            	//alert(origin_url);
	            	if(('/evalu/login/login' == origin_url) || ('///' == origin_url)  ||(real_url.indexOf("/evalu/login/login") != -1)){
	            		//如果起始就是登录模块，则跳到询价链接
	            		window.location.href = phone_url;
	            	}else{
	            		//否则跳转原链接
	            		window.location.href = real_url;			//	跳回原链接
	            	}
	            }else{
	            	//如果验证不通过，应该返回登录页面
	            	alert(data.msg);
	            	window.location.href = Jumpurl;
	            };
	        },
	        error: function() {
	            alert("系统错误，未能完成注册验证");
	        }
	    });
	}

</script>
</html>
